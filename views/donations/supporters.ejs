<!DOCTYPE html>
<html>
<head>
    <title>Our Supporters - Ella Rises</title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>
<body class="dashboard-body">
    <%- include('../partials/navbar') %>

    <main class="page-container">
        <div class="page-header">
            <div>
                <h1>Our Supporters</h1>
                <p class="page-subtitle">Thank you to everyone who makes Ella Rises possible</p>
            </div>
        </div>

        <% if (typeof myDonations !== 'undefined' && myDonations.length > 0) { %>
        <!-- My Donation History -->
        <div class="my-donations-section">
            <h2><i class="fas fa-gift"></i> Your Donation History</h2>
            <div class="my-donations-grid">
                <% myDonations.forEach(d => { %>
                    <div class="my-donation-card">
                        <div class="my-donation-amount">$<%= parseFloat(d.donation_amount).toFixed(2) %></div>
                        <div class="my-donation-date">
                            <% if (d.donation_date) { %>
                                <%= new Date(d.donation_date).toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' }) %>
                            <% } else { %>
                                Date not recorded
                            <% } %>
                        </div>
                    </div>
                <% }) %>
            </div>
            <p class="my-donations-thanks">Thank you for your generous support!</p>
        </div>
        <% } %>

        <!-- Gratitude Message -->
        <div class="gratitude-card">
            <div class="gratitude-icon">
                <i class="fas fa-heart"></i>
            </div>
            <p>
                We are deeply grateful for all who have generously donated to support Ella Rises. 
                Your contributions help us empower young women through STEAM education, workshops, 
                and mentorship programs.
            </p>
        </div>

        <!-- Search Bar -->
        <form class="search-bar" method="GET" action="/donations" id="searchForm">
            <i class="fas fa-search search-icon"></i>
            <input type="text" name="search" id="searchInput" placeholder="Search supporters by name..." value="<%= typeof search !== 'undefined' ? search : '' %>" <%= (typeof search !== 'undefined' && search) ? 'autofocus' : '' %>>
            <% if (typeof search !== 'undefined' && search) { %>
                <a href="/donations" class="search-clear">Clear</a>
            <% } %>
            <span class="search-count"><%= totalDonations %> supporters<%= (typeof search !== 'undefined' && search) ? ' found' : '' %></span>
        </form>
        <script>
            let searchTimeout;
            const searchInput = document.getElementById('searchInput');
            searchInput.addEventListener('input', function() {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    document.getElementById('searchForm').submit();
                }, 400);
            });
            if (searchInput.value) {
                searchInput.setSelectionRange(searchInput.value.length, searchInput.value.length);
            }
        </script>

        <% if (donations.length === 0) { %>
            <div class="empty-state">
                <p>No supporters found<%= (typeof search !== 'undefined' && search) ? ' matching "' + search + '"' : '' %>.</p>
                <% if (typeof search !== 'undefined' && search) { %>
                    <p><a href="/donations">Clear search</a></p>
                <% } %>
            </div>
        <% } else { %>
            <p class="results-info">Showing <%= donations.length %> of <%= totalDonations %> generous supporters</p>
            
            <div class="supporters-grid">
                <% donations.forEach(donation => { %>
                    <div class="supporter-card">
                        <div class="supporter-name">
                            <% if (donation.participant_first_name && donation.participant_last_name) { %>
                                <%= donation.participant_first_name %> <%= donation.participant_last_name %>
                            <% } else { %>
                                Anonymous Donor
                            <% } %>
                        </div>
                        <% if (donation.latest_donation) { %>
                            <div class="supporter-date">
                                <i class="fas fa-calendar-alt"></i>
                                <%= new Date(donation.latest_donation).toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' }) %>
                            </div>
                        <% } %>
                    </div>
                <% }) %>
            </div>

            <!-- Pagination -->
            <% if (totalPages > 1) { %>
                <%
                    let queryParams = '';
                    if (typeof search !== 'undefined' && search) queryParams += `search=${encodeURIComponent(search)}&`;
                %>
                <div class="pagination">
                    <% if (currentPage > 1) { %>
                        <a href="/donations?<%= queryParams %>page=<%= currentPage - 1 %>" class="pagination-btn">
                            <i class="fas fa-chevron-left"></i> Previous
                        </a>
                    <% } %>
                    
                    <span class="page-info">Page <%= currentPage %> of <%= totalPages %></span>
                    
                    <% if (currentPage < totalPages) { %>
                        <a href="/donations?<%= queryParams %>page=<%= currentPage + 1 %>" class="pagination-btn">
                            Next <i class="fas fa-chevron-right"></i>
                        </a>
                    <% } %>
                </div>
            <% } %>
        <% } %>

        <!-- Call to Action -->
        <div class="donate-cta">
            <p>Want to support Ella Rises?</p>
            <a href="/donations/donate" class="btn-add">Make a Donation</a>
        </div>
    </main>

    <%- include('../partials/footer') %>
</body>
</html>

